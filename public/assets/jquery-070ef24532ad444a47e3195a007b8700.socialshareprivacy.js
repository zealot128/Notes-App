/*
 * jquery.socialshareprivacy.js | 2 Klicks fuer mehr Datenschutz
 *
 * http://www.heise.de/extras/socialshareprivacy/
 * http://www.heise.de/ct/artikel/2-Klicks-fuer-mehr-Datenschutz-1333879.html
 *
 * Copyright (c) 2011 Hilko Holweg, Sebastian Hilbig, Nicolas Heiringhoff, Juergen Schmidt,
 * Heise Zeitschriften Verlag GmbH & Co. KG, http://www.heise.de
 *
 * is released under the MIT License http://www.opensource.org/licenses/mit-license.php
 *
 * Spread the word, link to us if you can.
 */
(function(a){a.fn.socialSharePrivacy=function(b){function g(a,b){var c=decodeURIComponent(a);if(c.length<=b)return a;var d=c.substring(0,b-1).lastIndexOf(" ");return c=encodeURIComponent(c.substring(0,d))+"â€¦",c}function h(a){var b=jQuery('meta[name="'+a+'"]').attr("content");return b?b:""}function i(){var b=h("DC.title"),c=h("DC.creator");return b.length>0?c.length>0&&(b=b+" - "+c):b=a("title").text(),encodeURIComponent(b)}var c={services:{facebook:{status:"on",app_id:"__FB_APP-ID__",dummy_img:"socialshareprivacy/images/dummy_facebook.png",txt_info:"2 Klicks f&uuml;r mehr Datenschutz: Erst wenn Sie hier klicken, wird der Button aktiv und Sie k&ouml;nnen Ihre Empfehlung an Facebook senden. Schon beim Aktivieren werden Daten an Dritte &uuml;bertragen &ndash; siehe <em>i</em>.",txt_fb_off:"nicht mit Facebook verbunden",txt_fb_on:"mit Facebook verbunden",perma_option:"on",display_name:"Facebook",referrer_track:"",language:"de_DE"},twitter:{status:"on",dummy_img:"socialshareprivacy/images/dummy_twitter.png",txt_info:"2 Klicks f&uuml;r mehr Datenschutz: Erst wenn Sie hier klicken, wird der Button aktiv und Sie k&ouml;nnen Ihre Empfehlung an Twitter senden. Schon beim Aktivieren werden Daten an Dritte &uuml;bertragen &ndash; siehe <em>i</em>.",txt_twitter_off:"nicht mit Twitter verbunden",txt_twitter_on:"mit Twitter verbunden",perma_option:"on",display_name:"Twitter",referrer_track:"",tweet_text:i},gplus:{status:"on",dummy_img:"socialshareprivacy/images/dummy_gplus.png",txt_info:"2 Klicks f&uuml;r mehr Datenschutz: Erst wenn Sie hier klicken, wird der Button aktiv und Sie k&ouml;nnen Ihre Empfehlung an Google+ senden. Schon beim Aktivieren werden Daten an Dritte &uuml;bertragen &ndash; siehe <em>i</em>.",txt_gplus_off:"nicht mit Google+ verbunden",txt_plus_on:"mit Google+ verbunden",perma_option:"on",display_name:"Google+",referrer_track:"",language:"de"}},info_link:"http://www.heise.de/ct/artikel/2-Klicks-fuer-mehr-Datenschutz-1333879.html",txt_help:"Wenn Sie diese Felder durch einen Klick aktivieren, werden Informationen an Facebook, Twitter oder Google in die USA &uuml;bertragen und unter Umst&auml;nden auch dort gespeichert. N&auml;heres erfahren Sie durch einen Klick auf das <em>i</em>.",settings_perma:"Dauerhaft aktivieren und Daten&uuml;ber&shy;tragung zustimmen:",cookie_path:"/",cookie_domain:document.location.host,cookie_expires:"365",css_path:"socialshareprivacy/socialshareprivacy.css"},b=a.extend(!0,c,b);if(b.services.facebook.status=="on"&&b.services.facebook.app_id!="__FB_APP-ID__"||b.services.twitter.status=="on"||b.services.gplusone.status=="on"){b.css_path&&a("head").append('<link rel="stylesheet" type="text/css" href="'+b.css_path+'" />'),a(this).prepend('<ul class="social_share_privacy_area"></ul>');var d=a(".social_share_privacy_area",this),e=document.location.href,f=a('link[rel="canonical"]').attr("href");f&&f.length>0&&(f.indexOf("http")<0&&(f=document.location.protocol+"//"+document.location.host+f),e=f)}return this.each(function(){if(b.services.facebook.status=="on")if(b.services.facebook.app_id!="__FB_APP-ID__"){var c=encodeURIComponent(e+b.services.facebook.referrer_track),f='<iframe src="http://www.facebook.com/plugins/like.php?locale='+b.services.facebook.language+"&amp;app_id="+b.services.facebook.app_id+"&amp;href="+c+'&amp;send=false&amp;layout=button_count&amp;width=120&amp;show_faces=false&amp;action=recommend&amp;colorscheme=light&amp;font&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden;" allowTransparency="true"></iframe>',h='<img src="'+b.services.facebook.dummy_img+'" alt="Facebook &quot;Like&quot;-Dummy" class="fb_like_privacy_dummy" />';d.append('<li class="facebook help_info"><span class="info">'+b.services.facebook.txt_info+'</span><span class="switch off">'+b.services.facebook.txt_fb_off+'</span><div class="fb_like dummy_btn">'+h+"</div></li>");var i=a("li.facebook",d);a("li.facebook div.fb_like img.fb_like_privacy_dummy,li.facebook span.switch",d).live("click",function(){i.find("span.switch").hasClass("off")?(i.addClass("info_off"),i.find("span.switch").addClass("on").removeClass("off").html(b.services.facebook.txt_fb_on),i.find("img.fb_like_privacy_dummy").replaceWith(f)):(i.removeClass("info_off"),i.find("span.switch").addClass("off").removeClass("on").html(b.services.facebook.txt_fb_off),i.find(".fb_like").html(h))})}else try{console.log("Fehler: Es ist keine Facebook App-ID hinterlegt.")}catch(j){}if(b.services.twitter.status=="on"){var k=b.services.twitter.tweet_text;typeof k=="function"&&(k=k()),k=g(k,"120");var l=encodeURIComponent(e+b.services.twitter.referrer_track),m=encodeURIComponent(e),n='<iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url='+l+"&amp;counturl="+m+"&amp;text="+k+'&amp;count=horizontal"></iframe>',o='<img src="'+b.services.twitter.dummy_img+'" alt="&quot;Tweet this&quot;-Dummy" class="tweet_this_dummy" />';d.append('<li class="twitter help_info"><span class="info">'+b.services.twitter.txt_info+'</span><span class="switch off">'+b.services.twitter.txt_twitter_off+'</span><div class="tweet dummy_btn">'+o+"</div></li>");var p=a("li.twitter",d);a("li.twitter div.tweet img,li.twitter span.switch",d).live("click",function(){p.find("span.switch").hasClass("off")?(p.addClass("info_off"),p.find("span.switch").addClass("on").removeClass("off").html(b.services.twitter.txt_twitter_on),p.find("img.tweet_this_dummy").replaceWith(n)):(p.removeClass("info_off"),p.find("span.switch").addClass("off").removeClass("on").html(b.services.twitter.txt_twitter_off),p.find(".tweet").html(o))})}if(b.services.gplus.status=="on"){var q=e+b.services.gplus.referrer_track,r='<div class="g-plusone" data-size="medium" data-href="'+q+'"></div><script type="text/javascript">window.___gcfg = {lang: "'+b.services.gplus.language+'"}; (function(){ var po = document.createElement("script"); po.type = "text/javascript"; po.async = true; po.src = "https://apis.google.com/js/plusone.js"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(po, s); })(); </script>',s='<img src="'+b.services.gplus.dummy_img+'" alt="&quot;Google+1&quot;-Dummy" class="gplus_one_dummy" />';d.append('<li class="gplus help_info"><span class="info">'+b.services.gplus.txt_info+'</span><span class="switch off">'+b.services.gplus.txt_gplus_off+'</span><div class="gplusone dummy_btn">'+s+"</div></li>");var t=a("li.gplus",d);a("li.gplus div.gplusone img,li.gplus span.switch",d).live("click",function(){t.find("span.switch").hasClass("off")?(t.addClass("info_off"),t.find("span.switch").addClass("on").removeClass("off").html(b.services.gplus.txt_gplus_on),t.find("img.gplus_one_dummy").replaceWith(r)):(t.removeClass("info_off"),t.find("span.switch").addClass("off").removeClass("on").html(b.services.gplus.txt_gplus_off),t.find(".gplusone").html(s))})}d.append('<li class="settings_info"><div class="settings_info_menu off perma_option_off"><a href="'+b.info_link+'"><span class="help_info icon"><span class="info">'+b.txt_help+"</span></span></a></div></li>"),a(".help_info:not(.info_off)",d).live("mouseenter",function(){var b=a(this),c=window.setTimeout(function(){a(b).addClass("display")},500);a(this).data("timeout_id",c)}),a(".help_info",d).live("mouseleave",function(){var b=a(this).data("timeout_id");window.clearTimeout(b),a(this).hasClass("display")&&a(this).removeClass("display")});if((b.services.facebook.status=="on"&&b.services.facebook.perma_option=="on"&&b.services.facebook.app_id!="__FB_APP-ID__"||b.services.twitter.status=="on"&&b.services.twitter.perma_option=="on"||b.services.gplus.status=="on"&&b.services.gplus.perma_option=="on")&&(a.browser.msie&&a.browser.version>7||!a.browser.msie)){var u=document.cookie.split(";"),v="{";for(var w=0;w<u.length;w++){var x=u[w].split("=");v+='"'+a.trim(x[0])+'":"'+a.trim(x[1])+'"',w<u.length-1&&(v+=",")}v+="}",v=JSON.parse(v);function y(a,b,c,d,e){var f=new Date;f.setTime(f.getTime()+c*24*60*60*1e3),document.cookie=a+"="+b+"; expires="+f.toUTCString()+"; path="+d+"; domain="+e}function z(a,c){var d=new Date;d.setTime(d.getTime()-100),document.cookie=a+"="+c+"; expires="+d.toUTCString()+"; path="+b.cookie_path+"; domain="+b.cookie_domain}var A=a("li.settings_info",d);A.find(".settings_info_menu").removeClass("perma_option_off"),A.find(".settings_info_menu").append('<span class="settings">Einstellungen</span><form><fieldset><legend>'+b.settings_perma+"</legend></fieldset></form>");if(b.services.facebook.status=="on"&&b.services.facebook.perma_option=="on"&&b.services.facebook.app_id!="__FB_APP-ID__"){var B="";v.socialSharePrivacy_facebook=="perma_on"?B=' checked="checked"':B="",A.find("form fieldset").append('<input type="checkbox" name="perma_status_facebook" id="perma_status_facebook"'+B+' /><label for="perma_status_facebook">'+b.services.facebook.display_name+"</label>")}if(b.services.twitter.status=="on"&&b.services.twitter.perma_option=="on"){var C="";v.socialSharePrivacy_twitter=="perma_on"?C=' checked="checked"':C="",A.find("form fieldset").append('<input type="checkbox" name="perma_status_twitter" id="perma_status_twitter"'+C+' /><label for="perma_status_twitter">'+b.services.twitter.display_name+"</label>")}if(b.services.gplus.status=="on"&&b.services.gplus.perma_option=="on"){var D="";v.socialSharePrivacy_gplus=="perma_on"?D=' checked="checked"':D="",A.find("form fieldset").append('<input type="checkbox" name="perma_status_gplus" id="perma_status_gplus"'+D+' /><label for="perma_status_gplus">'+b.services.gplus.display_name+"</label>")}A.find("span.settings").css("cursor","pointer"),a(A.find("span.settings"),d).live("mouseenter",function(){var b=window.setTimeout(function(){A.find(".settings_info_menu").removeClass("off").addClass("on")},500);a(this).data("timeout_id",b)}),a(A,d).live("mouseleave",function(){var b=a(this).data("timeout_id");window.clearTimeout(b),A.find(".settings_info_menu").removeClass("on").addClass("off")}),a(A.find("fieldset input")).live("click",function(c){var e,f=c.target.id;service=f.substr(f.lastIndexOf("_")+1,f.length),a("#"+c.target.id+":checked").length?e="on":e="off";var g="socialSharePrivacy_"+service;e=="on"?(y(g,"perma_on",b.cookie_expires,b.cookie_path,b.cookie_domain),a("form fieldset label[for="+f+"]",d).addClass("checked")):(z(g,"perma_on"),a("form fieldset label[for="+f+"]",d).removeClass("checked"))}),b.services.facebook.status=="on"&&b.services.facebook.perma_option=="on"&&v.socialSharePrivacy_facebook=="perma_on"&&b.services.facebook.app_id!="__FB_APP-ID__"&&a("li.facebook span.switch",d).click(),b.services.twitter.status=="on"&&b.services.twitter.perma_option=="on"&&v.socialSharePrivacy_twitter=="perma_on"&&a("li.twitter span.switch",d).click(),b.services.gplus.status=="on"&&b.services.gplus.perma_option=="on"&&v.socialSharePrivacy_gplus=="perma_on"&&a("li.gplus span.switch",d).click()}})}})(jQuery)